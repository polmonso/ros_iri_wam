<!-- Odometry testing -->
<launch>

<!-- YOU NEED TO DEFINE A BAG USING bag:=my.bag -->

  <arg name="rviz"       default="True" />
  <arg name="odom-icp"   default="False" />
  <arg name="odom-2d"    default="True" />
  <arg name="segway-status-topic" default="/teo/segway/status" />
  <arg name="odom-topic" default="/odom_exp" />
  <arg name="odom-topic-base" default="/teo/odom_publisher/odom" />
  <arg name="plot-pose"  default="True" />
  <arg name="plot-twist" default="false" />
  <arg name="plot-period" default="60" />

  <param name="/use_sim_time" value="True"/>

  <group ns="teo">
    <include file="$(find teo_base)/launch/teo_state_publisher.launch" />
  </group>


<!-- odom 2d -->
<node if="$(arg odom-2d)"
      name="segway_rmp400_odom"
      pkg="iri_segway_rmp400_odom"
      type="iri_segway_rmp400_odom"
      output="screen"
      >
      <remap from="~/platform_status" to="$(arg segway-status-topic)"/>
      <remap from="~/odom" to="$(arg odom-topic-base)"/>
      <param name="tf_prefix" value="teo"/>
      <param name="publish_tf" value="true"/>
      <param name="publish_tf" if="$(arg odom-icp)" value="false"/>
      <param name="base_link_id" value="base_footprint"/>
      <param name="odom_id" value="odom"/>
</node>

<!-- icp odom -->
  <node if="$(arg odom-icp)"
        name="laser_scan_matcher"
        pkg="laser_scan_matcher"
        type="laser_scan_matcher_node"
        output="screen"
        respawn="true"
        >
        <remap from="/scan" to="/teo/front_laser/scan"/>
        <remap from="/odom" to="$(arg odom-topic-base)"/>
        <param name="fixed_frame" value="/teo/odom"/>
        <param name="base_frame"  value="/teo/base_footprint"/>
        <param name="use_imu"        value="false"/>
        <param name="use_odom"       value="true"/>
        <param name="use_alpha_beta" value="false"/>
        <param name="max_iterations" value="10"/>
        <param name="publish_tf"   value="false"/>
        <param name="publish_pose" value="true"/>
  </node>
  <node if="$(arg odom-icp)"
        pkg="iri_pose2d_odom"
        type="iri_pose2d_odom"
        name="pose2d_odom"
        output="screen"
        >
        <remap from="~/pose2d" to="/pose2D" />
        <remap from="~/pose2d_odom" to="/teo/icp_odom" />
        <param name="parent_id"  value="/teo/odom" />
        <param name="frame_id"   value="/teo/base_footprint" />
        <param name="publish_tf" value="true" />
  </node>

<!-- YOUR ODOM TOPIC -->
  <node name="segway_rmp400_odom_3Dexpmaps"
        pkg="iri_segway_rmp400_odom"
        type="segway_rmp400_odom_3Dexpmaps"
        output="log"
        >
        <param name="tf_prefix" value="teo"/>
        <remap from="~/platform_status" to="$(arg segway-status-topic)"/>
        <remap from="~/odom" to="$(arg odom-topic)"/>
        <param name="publish_tf" value="false" />
  </node>


<!-- rviz -->
  <node if="$(arg rviz)"
        name="rviz_odom_test"
        pkg="rviz"
        type="rviz"
        args="-d $(find iri_segway_rmp400_odom)/config/testing/testing.vcg"
        />

<!-- rxplot pose-->
  <node if="$(arg plot-pose)"
        name="rxplot_pose"
        pkg="rxtools"
        type="rxplot"
        args="
        -t POSE
        -p $(arg plot-period)
        -l x_new,x_base,y_new,y_base,z_new,z_base
        $(arg odom-topic)/pose/pose/position/x,$(arg odom-topic-base)/pose/pose/position/x
        $(arg odom-topic)/pose/pose/position/y,$(arg odom-topic-base)/pose/pose/position/y
        $(arg odom-topic)/pose/pose/position/z,$(arg odom-topic-base)/pose/pose/position/z
        "
        />

<!-- rxplot twist-->
<node if="$(arg plot-twist)"
      name="rxplot_twist"
      pkg="rxtools"
      type="rxplot"
      args="
      -t TWIST
      -p $(arg plot-period)
      -l t_new,t_base,x_new,x_base,y_new,y_base,z_new,z_base
      $(arg odom-topic)/twist/twist/linear/x,$(arg odom-topic-base)/twist/twist/linear/x
      $(arg odom-topic)/twist/twist/angular/x,$(arg odom-topic-base)/twist/twist/angular/x
      $(arg odom-topic)/twist/twist/angular/y,$(arg odom-topic-base)/twist/twist/angular/y
      $(arg odom-topic)/twist/twist/angular/z,$(arg odom-topic-base)/twist/twist/angular/z
      "
      />

<!-- rosbag -->
  <node name="rosbag"
        type="rosbag"
        pkg="rosbag"
        output="screen"
        args = "play $(arg bag) --clock --delay=0"
        />
    <!-- >
    <remap from="" to=""/>
  </node>-->

</launch>
